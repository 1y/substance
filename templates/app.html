<!DOCTYPE html> 
<html> 
<head> 
  <title>Untitled — Substance™</title>
  
  <!-- templates -->
  <script type="text/x-handlebars-template" name="shelf">
    <div id="sbs_header">
      <div id="logo">
        <span class="label">SUBSTANCE™</span>
      </div>
      {{#username}}
        <div id="dashboard_toggle">
          <a class="header-icon dashboard" href="#toggle/dashboard" title="open the dashboard">open the dashboard</a>
          <span class="label">Dashboard</span>
          <a class="header-icon toggle-new-document" href="#new" title="create a new document">create a new document</a>
          <div class="document-type-selection">
            <a class="document-type new-document" type="story" href="#">Story</a>
            <a class="document-type new-document" type="conversation" href="#">Conversation</a>            
          </div>
        </div>
        <div id="new_document">
        
        </div>
      {{/username}}
      
      {{#document}}
        <div id="document_toggle">
          <span class="label">Now editing: <strong>{{../username}} / {{#name}}{{.}}{{/name}}{{^name}} untitled{{/name}}</strong></span>
          <a class="header-icon save-document right" href="#save_document" title="save current document">save current document</a>
          {{#name}}
            <a class="header-icon user view-collaborators" href="#show_collaborators" title="Show collaborating Users">Collaborators</a>
          {{/name}}
        </div>
      {{/document}}
      
      <div id="login_state">
        {{#username}}
          <span class="label">Signed in as: <strong>{{.}}</strong></span>
        
          <a class="header-icon logout right logout" href="#logout" title="log out">log out</a>
        {{/username}}
        {{^username}}
          <span class="label">Not logged in</span>
          <a class="header-icon login right" href="/" title="log in">log in</a>
        {{/username}}
      </div>
    </div>
    
    <div id="sbs_shelf_content">
    
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="drawer">
    <div class="drawer-actions">
      <div class="drawer-action"><a href="#" class="show-attributes">a</a></div>
    </div>
    
    <div id="drawer_content">
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="about">
    <div id="editor">
      <h3>Welcome</h3>
      <p>You can select some <em>Content-Nodes</em> on the left to edit the contents. You can drag <em>Nodes</em> around to arrange them. 
      But keep in mind this is an early draft/sketch. Things will get more stable as we work on it.
      </p>
      <p>
      And you can help by giving <a href="http://github.com/michael/substance/issues">feedback</a> or
      reporting <a href="http://github.com/michael/substance/issues">bugs</a>.
      </p>
      <p>
      Please have a look at the <a href="http://github.com/michael/substance">README</a> to learn more.
      </p>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="editor">
    <div id="outline"></div>
    <div id="main">
      <div id="drawer">
      </div>
      <div id="document">
        <p>No document loaded... You can either create a <em>New Document</em> or <em>Browse</em> existing ones.</p>
      </div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="login">
    <div id="signup">
      <h3>Login</h3>
      <div class="lpl texteditor">
        <form id="login-form">
          <label for="login-user">username</label>
          <input type="text" name="username" id="login-user" value="demo">
          <label for="login-password">password</label>
          <input type="password" name="password" id="login-password" value="demo">
          <p><br/>
          <input type="submit" value="Login"/>
          </p>
          <a href="/" class="signup">Create a free account</a>
        </form>
      </div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="signup">
    <div id="signup">
      <h3>Sign up</h3>
      <div class="lpl texteditor">
        <form id="signup-form">
          <label for="signup-user">username</label>
          <input type="text" name="username" id="signup-user" value="">
          <label for="signup-email">email</label>
          <input type="text" name="email" id="signup-email" value="">
          <label for="signup-password">password</label>
          <input type="text" name="password" id="signup-password" value="">
          <p><br/>
          <input type="submit" value="Create an account"/>
          </p>
        </form>
      </div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="browser_not_supported">
    <div id="signup">
      <h3>Your Browser is currently not supported</h3>
      <div class="lpl texteditor">
        <p>
        Substance makes use of WebSockets, a new technology that allows realtime communication.
        </p>
        <p>Please take the time to upgrade your browser to one of those supporting WebSockets — it is worth it!</p>
        <div style="text-align: center;">
          <a href="http://www.google.com/chrome/" title="Google Chrome"><img src="/images/chrome.png"/></a>
          <a href="http://www.apple.com/safari/" title="Safari 5"><img src="/images/safari.png"/></a>
          <a href="http://www.mozilla.com/en-US/firefox/beta/" title="Firefox 4 Beta"><img src="/images/firefox.png"/></a>
        </div>
      </div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="collaborators">
    <h3>Currently active Collaborators</h3>
    <ul>
      {{#status/collaborators}}
        <li>{{.}}</li>
      {{/status/collaborators}}
    </ul>
    <p></p>
    <p>Invite new collaborators by sharing this link:</p>
    <p>
      <input type="text" value="http://{{hostname}}/#{{author}}/{{name}}" style="width: 450px;"></input>
    </p>
  </script>
  
  <script type="text/x-handlebars-template" name="create_document">
    <h3>Create document</h3>
    <p>Please use a unique document identifier (e.g. "resume").</p>
    <div>
      <form id="create-document-form">
        <label for="document-name">File as:</label>
        <input type="text" name="user_name" id="user-name" value="{{username}}" disabled="disabled">
        / <input type="text" name="document_name" id="document-name">
        <input type="submit" value="Save"/>
      </form>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="dashboard">
    <div id="document_browser">
      
    </div>
    
    <div id="search_panel">
      <br/>
      <a href="#new" class="new-document">
        <img src="/images/new-document.png"/>
      </a>
      
      <!--<h2>Active Users:</h2>
      <div id="active_users">
        {{#active_users}}
          <div class="user">
          {{.}}
            <!--<a class="link load-document" href="#load/{{username}}/{{value/data/name}}" document="{{value/_id}}" user="{{username}}" name="{{value/data/name}}">
              <div class="icon"><img src="/images/document_icon.png"/></div>
              <div class="content">
                <h5 class="title">{{value/data/title}}</h5>
                <p class="meta">Updated {{last_modified}}</p>
                
              </div>
            </a>-->
          </div>
        {{/active_users}}
      </div>-->
      
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="document_browser">

      <div id="facets">
        Loading facets...
      </div>
      <!--<div id="document_search">
        <label>Search for documents</label><br/>
        <input type="text" name="searchstr" id="search_documents"/>
      </div>-->
      <div id="documents" class="document-list">
        <h2>{{num_documents}} Documents:</h2>
        <div class="list">
          {{#documents}}
            <div class="document">
              <a class="link load-document" href="#load/{{username}}/{{value/data/name}}" document="{{value/_id}}" user="{{username}}" name="{{value/data/name}}">
                <div class="icon"><img src="/images/document_icon.png"/></div>
                <div class="content">
                  <h5 class="title">{{value/data/title}}</h5>
                  <p class="meta">Updated {{last_modified}}</p>
                  <p class="status {{status}}">{{status}} {{document_type}}</p>
                </div>
              </a>
              <a href="#" class="delete-document remove" document="{{value/_id}}">x</a>
            </div>
          {{/documents}}
        </div>
        <br class="clear"/>
      </div>
  </script>
  
  
  <script type="text/x-handlebars-template" name="facets">
    <h2>{{num_documents}} Filter by attributes:</h2>
    <div class="list">
      {{#facets}}
        <div class="facet" id="facet_{{property}}">
          <h3>{{property_name}}</h3>
          <ul class="facet-choices">
            {{#selected_facet_choices}}
              <li class="facet-choice selected"><a href="#" class="remove-criterion" property="{{../property}}" operator="CONTAINS" value="{{value}}">{{value}}<span class="item-count">{{item_count}}</span></a></li>
            {{/selected_facet_choices}}
            {{#facet_choices}}
              <li class="facet-choice"><a href="#" class="add-criterion" property="{{../property}}" operator="CONTAINS" value="{{value}}">{{value}}<span class="item-count">{{item_count}}</span></a></li>
            {{/facet_choices}}
          </ul>
        </div>
      {{/facets}}
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="controls">
    <div class="controls" node="{{node/key}}" destination="{{destination}}">
      <div class="handle">
        <a href="#">--&gt; INSERT</a>
      </div>
      <div class="actions">
        {{#actions}}
          <a href="#" type="{{nodeType}}" node="{{node}}" parent="{{parentNode}}" class="add_{{insertionType}}">{{nodeTypeName}}</a>
        {{/actions}}
        <br class="clear"/>
      </div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="edit_text">
    <h3>Edit Text</h3>
    <div class="lpl texteditor" id="edit_node">
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="edit_image">
    <form id="upload_image" action="http://api2.transloadit.com/assemblies" enctype="multipart/form-data" method="POST">
      <div class="lpl texteditor">
          <label for="my_file">select file</label>
          <input type="file" name="my_file" id="my_file" />
          <input type="hidden" name="params" value="{&quot;auth&quot;:{&quot;key&quot;:&quot;4ccca6b9de144af4882760af72ec3211&quot;},&quot;steps&quot;:{&quot;resize_image&quot;:{&quot;robot&quot;:&quot;\/image\/resize&quot;,&quot;width&quot;:320,&quot;height&quot;:240,&quot;result&quot;:true}},&quot;redirect_url&quot;:&quot;http:\/\/example.com\/upload&quot;}" />
          <input type="submit" value="Upload">
      </div>
      <div id="progress_container">
        <div class="lpl progress-container"><div id="upload_progress" class="lpl progress-bar stripes animated" style="width:60%"></div></div>
        <div id="image_progress_legend" class="lpl legend">
      </div>
    </form>
  </script>
  
  <script type="text/x-handlebars-template" name="edit_section">
    <h3>Edit section</h3>
  </script>
  
  
  <script type="text/x-handlebars-template" name="edit_unsaved_document">
    <h2>Attributes</h2>
    <p class="info">
      You are editing a draft document. You need to <a href="#" class="save-document">save</a> it in order to to edit attributes.
    </p>
  </script>
  
  <script type="text/x-handlebars-template" name="edit_document">
    <h2>Attributes</h2>
    
    <dl class="document-attributes">
      <dt>Author:</dt>
      <dd>{{document/author}} {{document/author}}</dd>
      
      <dt>Created At:</dt>
      <dd>{{created_at}}</dd>
      
      <dt>Last modified:</dt>
      <dd>{{updated_at}}</dd>
      
      <dt>Publish Date:</dt>
      <dd>
        {{published_on}} 
          
        {{^unpublished}}
          (<a href="#" class="unpublish-document">Unpublish</a>)
        {{/unpublished}}
        
        {{^published_on}}
          not published (<a href="/" class="publish-document">Publish</a>)
        {{/published_on}}
      </dd>
    </dl>
    
    <div class="lpl texteditor">
      {{#attributes}}
        <h4>{{name}}</h4>
        <div id="property_{{key}}" key="{{key}}" type="{{type}}" class="attribute-editor {{#unique}} unique{{/unique}}{{^unique}} non-unique{{/unique}}"></div>
      {{/attributes}}
    </div>
  </script>

  
  <!-- content-node templates for the editor -->
  <script type="text/x-handlebars-template" name="document">    
    <div id="{{node/html_id}}" name={{node/key}} class="content-node document">
      <!--<div class="content-node-info">Document</div>-->
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      <h1 contenteditable="true" class='content'>{{title}}</h1>
      
      <p class="lead content" id="document_lead" contenteditable="true">{{lead}}</p>
      {{{content}}}
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="section">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" draggable="false" class="content-node section">
      <a href="#" class="remove remove-node" node="{{node/key}}" parent="{{parent/_id}}">x</a>
      <!--<div class="content-node-info" draggable="false">Section</div>-->
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      
      <h2 contenteditable="true" class='content'>{{name}}</h2>
      <div class="node-editor-placeholder"></div>
      {{{content}}}
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="text">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" draggable="false" class="content-node text">
      <a href="#" class="remove-node remove" node="{{node/key}}" parent="{{parent/_id}}">x</a>
      <!--<div class="content-node-info" draggable="false">Text</div>-->
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      <div class='content' contenteditable="true">{{{content}}}</div>
      <div class="node-editor-placeholder"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="quote">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" draggable="false" class="content-node quote">
      <a href="#" class="remove-node remove" node="{{node/key}}" parent="{{parent/_id}}">x</a>
      <!--<div class="content-node-info" draggable="false">Quote</div>-->
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      <quote class='content' contenteditable="true">{{{content}}}</quote>
      <div class="node-editor-placeholder"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="code">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" draggable="false" class="content-node code">
      <a href="#" class="remove-node remove" node="{{node/key}}" parent="{{parent/_id}}">x</a>
      <!--<div class="content-node-info" draggable="false">Code</div>-->
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      <pre><code class='content' contenteditable="true">{{{content}}}</code></pre>
      <div class="node-editor-placeholder"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="question">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" draggable="false" class="content-node question">
      <a href="#" class="remove-node remove" node="{{node/key}}" parent="{{parent/_id}}">x</a>
      <!--<div class="content-node-info" draggable="false">Question</div>-->
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      <p class='question content' contenteditable="true">{{{content}}}</p>
      <div class="node-editor-placeholder"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="answer">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" draggable="false" class="content-node answer">
      <a href="#" class="remove-node remove" node="{{node/key}}" parent="{{parent/_id}}">x</a>
      <!--<div class="content-node-info" draggable="false">Answer</div>-->
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      <p class='answer content' contenteditable="true">{{{content}}}</quote>
      <div class="node-editor-placeholder"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="image">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" draggable="false" class="content-node image">
      <a href="#" class="remove remove-node" node="{{node/key}}" parent="{{parent/_id}}">x</a>
      <!--<div class="content-node-info" draggable="false">Image</div>-->
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      {{#url}}
        <img src="{{.}}"/>
      {{/url}}
      {{^url}}
        [Upload image]
      {{/url}}
      <div class="node-editor-placeholder">
        
      </div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="multi_string_editor">
    <form>
      <input type="text" name="new_value"/>
      <input type="submit" value="+"/>
    </form>
    <div class="items">
      {{#items}}
        <span class="item">{{.}} <a href="/" value="{{.}}" class="remove-item">x</a></span>
      {{/items}}
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="string_editor">
    <input type="text" name="value" value="{{value}}"/>
  </script>
  
  <!-- styles --> 
  <!-- <link href="stylesheets/reset.css" media="screen" rel="stylesheet" type="text/css" />-->
  <link href="stylesheets/widgets.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
  
  <!-- libraries --> 
  <script src="lib/jquery-1.4.3.min.js"></script>
  <script src="lib/handlebars.js"></script>
  <script src="lib/showdown.js"></script>

  <!-- transloadit.com file processing service -->
  <script src="lib/jquery.transloadit2.js"></script>
  
  <!-- Libraries -->
  <script src="lib/underscore.js"></script>
  <script src="lib/data.js"></script>
  <script src="lib/adapters/ajax_adapter.js"></script>
  <script src="lib/unveil.js"></script>
  <script src="lib/backbone.js"></script>
  <script src="lib/sanitize.js"></script>
  <script src="lib/proper.js"></script>
  <script src="dnode.js"></script>
  
  <!-- Backbone Extensions -->
  <script src="src/backend/notifier.js"></script>
  
  <!-- Shared helpers -->
  <script src="src/shared/helpers.js"></script>
  
  <!-- The app -->
  <script src="src/backend/renderers/html_renderer.js"></script>
  <script src="src/backend/node_editors/document_editor.js"></script>
  <script src="src/backend/node_editors/section_editor.js"></script>
  <script src="src/backend/node_editors/text_editor.js"></script>
  <script src="src/backend/node_editors/quote_editor.js"></script>
  <script src="src/backend/node_editors/code_editor.js"></script>
  <script src="src/backend/node_editors/question_editor.js"></script>
  <script src="src/backend/node_editors/answer_editor.js"></script>
  
  <script src="src/backend/node_editors/image_editor.js"></script>
  <script src="src/backend/controllers/application.js"></script>
  
  <!-- UI components -->
  <script src="src/backend/ui/common.js"></script>
  <script src="src/backend/ui/string_editor.js"></script>
  <script src="src/backend/ui/multi_string_editor.js"></script>
  
  <!-- Visualizations -->
  <script src="src/backend/visualizations/outline.js"></script>
  
  <!-- Views -->
  <script src="src/backend/views/dashboard.js"></script>
  <script src="src/backend/views/editor.js"></script>
  <script src="src/backend/views/create_document.js"></script>
  <script src="src/backend/views/document_view.js"></script>
  <script src="src/backend/views/shelf.js"></script>
  <script src="src/backend/views/drawer.js"></script>
  <script src="src/backend/views/attributes.js"></script>
  
  <script src="src/shared/commands.js"></script>
  <script src="src/shared/views/document_browser.js"></script>
  <script src="src/shared/views/facets.js"></script>
  
  <script src="src/backend/views/collaborators.js"></script>
  <script src="src/backend/views/application.js"></script>
  
</head>
<body>
  <div id="container">
    <div id="sbs_shelf">
    </div>
    <div id="dashboard">
    </div>
    <div id="editor">
    </div>
  </div>
  
  <div id="notifications">
    <div class="wrapper">
    </div>
  </div>

</body> 
</html>